# Python-Solution 智慧教育平台下载工具

## 项目概述
这是一个用于批量下载智慧教育平台教材资源的Python工具集，支持PDF教材和音频资源的下载。经过优化整合，现在只需要一个主程序即可完成所有下载任务。

## 核心文件

### 1. 主程序
- **batch_downloader.py** - 整合版批量下载器
  - 支持所有类型教材（普通教材和专题课程）
  - 智能提取并下载音频资源（MP3）
  - CDN自动切换，提高下载成功率
  - 请求速率限制，避免被封禁
  - 支持断点续传和失败重试

### 2. 数据准备工具
- **api_analysis_simple.py** - 获取教材目录数据
  - 从平台API获取最新目录
  - 生成分类的下载列表
  
- **generate_download_tasks.py** - 生成下载任务
  - 将目录数据转换为标准下载任务
  - 创建规范的文件命名和目录结构

### 3. 核心数据文件
- **download_tasks.json** - 下载任务列表（3471个教材）
- **catalog_output/** - 目录数据（可选保留）
- **multimedia_resources.json** - 多媒体资源记录（下载时生成）

### 4. 文档
- **下载使用说明.md** - 详细使用指南
- **目录生成成功报告.md** - 目录分析报告

## 快速开始

### 1. 获取Token
使用 Tampermonkey 脚本从浏览器获取认证Token（见 `../tampermonkey/` 目录）

### 2. 下载教材
```bash
# 下载所有教材（含音频）
python batch_downloader.py --token "你的Token"

# 仅下载PDF（最快）
python batch_downloader.py --token "你的Token" --no-multimedia

# 按学段下载
python batch_downloader.py --token "你的Token" --stage 小学

# 按学科下载
python batch_downloader.py --token "你的Token" --subject 英语
```

### 3. 重试失败任务
```bash
python batch_downloader.py --token "你的Token" --retry-failed
```

## 主要功能

### 核心特性
- ✅ 批量下载3471本教材
- ✅ 智能提取音频资源
- ✅ 支持专题课程
- ✅ CDN自动切换
- ✅ 断点续传
- ✅ 失败重试
- ✅ 进度显示
- ✅ 详细日志

### 过滤选项
- 按学段：小学、初中、高中、特殊教育等
- 按学科：语文、数学、英语等
- 按版本：人教、北师大、苏教等
- 限制数量：用于测试

### 性能优化
- 并发控制（默认3线程）
- 请求速率限制（默认2.0/秒）
- 指数退避重试策略
- 文件大小验证

## 目录结构
```
教材库/
├── 小学/
│   ├── 语文/
│   │   └── 人教/
│   └── 英语/
│       └── 人教/
│           └── 3年级/
│               └── 上/
│                   ├── 英语_3年级_上_人教.pdf
│                   └── 英语_3年级_上_人教_音频/
│                       └── Unit 1/
│                           └── Lesson 1/
│                               └── AUDIO-1_Listen and say.mp3
├── 初中/
├── 高中/
└── 特殊教育/
```

## 教材统计
- 总数：3471本
- 小学：1530本
- 初中：875本  
- 高中：511本
- 特殊教育：289本
- 小学（五•四学制）：110本
- 初中（五•四学制）：156本

## 注意事项
1. Token有效期有限，失效需重新获取
2. 建议使用默认并发和速率设置
3. 完整下载需要约200GB存储空间
4. 视频资源因DRM保护无法下载
5. 音频主要存在于语言类教材

## 技术依赖
- Python 3.7+
- requests
- tqdm
- 标准库：json, pathlib, threading等

## 更新日志
- 2025-09-14：更新数据统计，清理无效教材
- 2025-09-13：整合所有功能到单一下载器
- 2025-09-13：移除冗余的分析工具
- 2025-09-13：优化音频提取和目录组织
- 2025-09-13：添加CDN切换功能
- 2025-09-13：完善文档说明