<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å°å­¦æ•™æä¸‹è½½ä¸­å¿ƒ - 4023æœ¬æ•™æèµ„æº</title>
    <meta name="description" content="å›½å®¶ä¸­å°å­¦æ•™æä¸‹è½½ä¸­å¿ƒï¼Œæä¾›å°å­¦ã€åˆä¸­ã€é«˜ä¸­ç­‰4023æœ¬æ•™æçš„PDFä¸‹è½½">
    <meta name="keywords" content="æ™ºæ…§æ•™è‚²,æ•™æä¸‹è½½,ç”µå­æ•™æ,PDFæ•™æ,ä¸­å°å­¦æ•™æ">
    <style>
        /* CSSå˜é‡ */
        :root {
            --primary: #1890ff;
            --primary-hover: #40a9ff;
            --success: #52c41a;
            --warning: #faad14;
            --error: #ff4d4f;
            --border: #e8e8e8;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #262626;
            --text-secondary: #8c8c8c;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08);
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.12);
            --radius: 8px;
            --radius-sm: 4px;
            --transition: all 0.3s ease;
        }

        /* æš—è‰²ä¸»é¢˜ */
        [data-theme="dark"] {
            --bg: #1a1a1a;
            --card-bg: #2a2a2a;
            --text: #e8e8e8;
            --text-secondary: #a8a8a8;
            --border: #404040;
            --popular-bg: #232323;
        }

        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 
                         'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
            min-height: 100vh;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* å¸ƒå±€å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* å¤´éƒ¨ */
        header {
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .logo-icon {
            font-size: 28px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stats {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stats strong {
            color: var(--primary);
            font-weight: 600;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 6px 10px;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        /* æœç´¢åŒºåŸŸ */
        .search-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 0;
            position: relative;
            overflow: hidden;
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .search-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .search-title {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 300;
        }

        .search-box {
            display: flex;
            height: 56px;
            background: white;
            border-radius: 28px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .search-box:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 0 24px;
            font-size: 16px;
            outline: none;
            background: transparent;
        }

        .search-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 32px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            background: var(--primary-hover);
        }

        /* å¿«æ·ç­›é€‰æ ‡ç­¾ */
        .quick-filters {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-btn {
            padding: 6px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .quick-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .quick-btn.active {
            background: white;
            color: var(--primary);
            border-color: white;
        }

        /* ä¸»ä½“å†…å®¹ */
        .main {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            min-height: calc(100vh - 300px);
        }

        /* ç­›é€‰é¢æ¿ */
        .filters {
            width: 280px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            height: fit-content;
            position: sticky;
            top: 80px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .filter-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .filter-clear-all {
            font-size: 12px;
            color: var(--primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-clear-all:hover {
            text-decoration: underline;
        }

        .filter-group {
            margin-bottom: 28px;
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .filter-clear {
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: normal;
            opacity: 0;
            transition: var(--transition);
        }

        .filter-group:hover .filter-clear {
            opacity: 1;
        }

        .filter-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .filter-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 0;
            transition: var(--transition);
        }

        .filter-item:hover {
            color: var(--primary);
        }

        .filter-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .filter-item label {
            flex: 1;
            cursor: pointer;
            user-select: none;
        }

        .filter-count {
            color: var(--text-secondary);
            font-size: 12px;
            background: var(--bg);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
        }

        /* å·¥å…·æ  */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .result-info {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .result-info strong {
            color: var(--primary);
            font-size: 20px;
            font-weight: 600;
            margin: 0 4px;
        }

        .toolbar-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .sort-select {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: var(--card-bg);
            cursor: pointer;
            transition: var(--transition);
        }

        .sort-select:hover {
            border-color: var(--primary);
        }

        .view-toggle {
            display: flex;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .view-btn {
            background: var(--card-bg);
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }

        .view-btn:hover {
            background: var(--bg);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        /* æ•™æè¡¨æ ¼è§†å›¾ */
        .textbook-table {
            width: 100%;
            border-collapse: collapse;
        }

        .textbook-table th {
            background: var(--bg);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 60px;
            z-index: 10;
        }

        .textbook-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .textbook-table tr {
            transition: var(--transition);
        }

        .textbook-table tr:hover {
            background: var(--bg);
        }

        .textbook-name {
            font-weight: 500;
            color: var(--text);
            font-size: 15px;
        }

        .textbook-meta {
            display: flex;
            gap: 12px;
            margin-top: 4px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .meta-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-download {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-download:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* ç½‘æ ¼è§†å›¾ */
        .textbook-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .textbook-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: var(--transition);
            cursor: pointer;
        }

        .textbook-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .card-header {
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .card-tag {
            font-size: 12px;
            padding: 4px 10px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
        }

        .card-tag.primary {
            background: rgba(24, 144, 255, 0.1);
            color: var(--primary);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .card-size {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 40px;
        }

        .page-btn {
            padding: 8px 12px;
            min-width: 40px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            text-align: center;
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--primary);
            color: var(--primary);
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-ellipsis {
            color: var(--text-secondary);
            padding: 0 8px;
        }

        /* ä¸‹è½½å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 32px;
            max-width: 650px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            line-height: 1;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
        }

        .modal-close:hover {
            background: var(--bg);
            color: var(--text);
        }

        .download-info {
            background: var(--bg);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .download-info h4 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--text);
            font-weight: 600;
        }

        .download-info p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .download-field {
            margin-bottom: 28px;
        }

        .download-field label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            color: var(--text);
            font-size: 15px;
        }

        .download-link {
            position: relative;
            display: flex;
            align-items: center;
        }

        .download-link input {
            width: 100%;
            padding: 14px 48px 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: 'SF Mono', Consolas, monospace;
            font-size: 14px;
            background: var(--bg);
            color: var(--text);
            transition: var(--transition);
        }
        
        .download-link input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card-bg);
        }

        .copy-icon {
            position: absolute;
            right: 12px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius-sm);
        }

        .copy-icon:hover {
            color: var(--primary);
            background: var(--bg);
        }

        .copy-icon.copied {
            color: var(--success);
        }

        .copy-icon svg {
            width: 16px;
            height: 16px;
        }
        
        /* æ–‡ä»¶è·¯å¾„ç‰¹æ®Šå¸ƒå±€ */
        .download-field-path {
            margin-bottom: 24px;
        }
        
        .download-field-path input {
            font-size: 13px;
            word-break: break-all;
            height: auto;
            min-height: 48px;
            padding: 14px 48px 14px 16px;
            resize: none;
        }

        .btn-open {
            display: block;
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin-top: 32px;
            transition: var(--transition);
            height: 52px;
        }

        .btn-open:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .download-tips {
            margin-top: 24px;
            padding: 16px 20px;
            background: rgba(24, 144, 255, 0.05);
            border-left: 3px solid var(--primary);
            border-radius: var(--radius-sm);
        }

        .download-tips h5 {
            font-size: 15px;
            margin-bottom: 10px;
            color: var(--text);
            font-weight: 600;
        }

        .download-tips ul {
            list-style: none;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .download-tips li {
            padding-left: 24px;
            position: relative;
            margin-bottom: 6px;
        }

        .download-tips li::before {
            content: 'â€¢';
            position: absolute;
            left: 10px;
            color: var(--primary);
            font-weight: bold;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        .spinner {
            display: inline-block;
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç©ºçŠ¶æ€ */
        .empty {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-hint {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ç§»åŠ¨ç«¯ç­›é€‰æŒ‰é’® */
        .mobile-filter-btn {
            display: none;
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            box-shadow: var(--shadow-lg);
            font-size: 24px;
            cursor: pointer;
            z-index: 90;
            transition: var(--transition);
        }

        .mobile-filter-btn:hover {
            transform: scale(1.1);
        }

        /* ç§»åŠ¨ç«¯é®ç½© */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 150;
        }

        .mobile-overlay.show {
            display: block;
        }

        /* å“åº”å¼ */
        @media (max-width: 1024px) {
            .container {
                padding: 0 16px;
            }

            .main {
                position: relative;
            }

            .filters {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                width: 300px;
                z-index: 200;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                border-radius: 0;
            }

            .filters.show {
                left: 0;
            }

            .mobile-filter-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .content {
                width: 100%;
            }

            .textbook-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 12px 0;
            }

            .logo {
                font-size: 16px;
            }

            .logo-icon {
                font-size: 24px;
            }

            .search-section {
                padding: 24px 0;
            }

            .search-title {
                font-size: 18px;
                margin-bottom: 16px;
            }

            .search-box {
                height: 48px;
            }

            .search-input {
                font-size: 14px;
                padding: 0 16px;
            }

            .search-btn {
                padding: 0 24px;
                font-size: 14px;
            }

            .quick-filters {
                gap: 8px;
            }

            .quick-btn {
                padding: 4px 16px;
                font-size: 13px;
            }

            .toolbar {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .toolbar-actions {
                width: 100%;
                justify-content: space-between;
            }

            .textbook-table {
                font-size: 13px;
            }

            .textbook-table th,
            .textbook-table td {
                padding: 12px;
            }

            .hide-mobile {
                display: none !important;
            }

            .btn-download {
                padding: 6px 16px;
                font-size: 13px;
            }

            .textbook-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .pagination {
                gap: 4px;
            }

            .page-btn {
                padding: 6px 10px;
                min-width: 36px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .stats {
                display: none;
            }

            .modal-content {
                margin: 16px;
                padding: 24px;
                max-width: 100%;
            }
            
            .download-field {
                margin-bottom: 20px;
            }
            
            .download-tips {
                padding: 14px 16px;
            }
            
            .download-tips li {
                padding-left: 20px;
            }
        }


        /* çƒ­é—¨æ•™æå¿«æ·å…¥å£æ ·å¼ */
        .popular-section {
            background: #f5f7fa;
            padding: 30px 0;
            margin-top: -20px;
            transition: var(--transition);
        }
        
        [data-theme="dark"] .popular-section {
            background: var(--popular-bg);
        }

        .popular-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .popular-header h3 {
            font-size: 24px;
            color: var(--text);
            margin-bottom: 8px;
        }

        .popular-header p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        .popular-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .popular-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .popular-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-hover);
        }

        .popular-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .popular-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .popular-count {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* å“åº”å¼è®¾è®¡ - äººæ•™ç‰ˆä¸“åŒº */
        @media (max-width: 768px) {
            .renjiao-card {
                padding: 20px;
            }

            .renjiao-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .hot-combos-grid {
                grid-template-columns: 1fr;
            }

            .grade-buttons {
                margin-left: 0;
                margin-top: 10px;
            }

            .subject-grid {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            }

            .renjiao-actions {
                flex-direction: column;
            }

            .popular-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 12px;
            }

            .popular-btn {
                padding: 20px 16px;
            }

            .popular-icon {
                font-size: 28px;
            }

            .popular-title {
                font-size: 14px;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            header,
            .search-section,
            .renjiao-section,
            .filters,
            .toolbar,
            .pagination,
            .mobile-filter-btn,
            .btn-download {
                display: none !important;
            }

            .main {
                display: block;
            }

            .content {
                box-shadow: none;
                padding: 0;
            }

            .textbook-table {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸ“š</span>
                    <span>ä¸­å°å­¦æ•™æä¸‹è½½ä¸­å¿ƒ</span>
                </div>
                <div class="header-actions">
                    <div class="stats">
                        å…±æ”¶å½• <strong id="totalCount">4023</strong> æœ¬æ•™æ
                    </div>
                    <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">
                        ğŸŒ™
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- æœç´¢åŒºåŸŸ -->
    <section class="search-section">
        <div class="container">
            <div class="search-wrapper">
                <h1 class="search-title">å¿«é€ŸæŸ¥æ‰¾æ‚¨éœ€è¦çš„æ•™æèµ„æº</h1>
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="æœç´¢æ•™æåç§°ã€å­¦ç§‘ã€å¹´çº§ã€ç‰ˆæœ¬..." 
                           autocomplete="off">
                    <button class="search-btn" onclick="search()">
                        <span>æœç´¢</span>
                    </button>
                </div>
                <div class="quick-filters">
                    <button class="quick-btn" onclick="quickFilter('stage', 'å°å­¦')">å°å­¦</button>
                    <button class="quick-btn" onclick="quickFilter('stage', 'åˆä¸­')">åˆä¸­</button>
                    <button class="quick-btn" onclick="quickFilter('stage', 'é«˜ä¸­')">é«˜ä¸­</button>
                    <button class="quick-btn" onclick="quickFilter('subject', 'è¯­æ–‡')">è¯­æ–‡</button>
                    <button class="quick-btn" onclick="quickFilter('subject', 'æ•°å­¦')">æ•°å­¦</button>
                    <button class="quick-btn" onclick="quickFilter('subject', 'è‹±è¯­')">è‹±è¯­</button>
                    <button class="quick-btn" onclick="quickFilter('publisher', 'äººæ•™')">äººæ•™ç‰ˆ</button>
                    <button class="quick-btn" onclick="quickFilter('publisher', 'åŒ—å¸ˆå¤§')">åŒ—å¸ˆå¤§ç‰ˆ</button>
                </div>
            </div>
        </div>
    </section>

    <!-- çƒ­é—¨æ•™æå¿«æ·å…¥å£ -->
    <section class="popular-section">
        <div class="container">
            <div class="popular-header">
                <h3>ğŸ”¥ çƒ­é—¨æ•™æå¥—è£…</h3>
                <p>å¿«é€ŸæŸ¥æ‰¾å¸¸ç”¨æ•™æç»„åˆ</p>
            </div>
            <div class="popular-grid">
                <button class="popular-btn" onclick="quickTextbookFilter('ç»Ÿç¼–ç‰ˆå°å­¦è¯­æ–‡')"><div class="popular-icon">ğŸ“–</div><div class="popular-title">ç»Ÿç¼–ç‰ˆå°å­¦è¯­æ–‡</div><div class="popular-count" id="pop-tb-primary-chinese">12æœ¬</div></button>
                <button class="popular-btn" onclick="quickTextbookFilter('äººæ•™ç‰ˆå°å­¦æ•°å­¦')"><div class="popular-icon">ğŸ“</div><div class="popular-title">äººæ•™ç‰ˆå°å­¦æ•°å­¦</div><div class="popular-count" id="pop-rj-primary-math">12æœ¬</div></button>
                <button class="popular-btn" onclick="quickTextbookFilter('äººæ•™ç‰ˆåˆä¸­å…¨å¥—')"><div class="popular-icon">ğŸ“š</div><div class="popular-title">äººæ•™ç‰ˆåˆä¸­å…¨å¥—</div><div class="popular-count" id="pop-rj-middle-all">79æœ¬</div></button>
                <button class="popular-btn" onclick="quickTextbookFilter('åŒ—å¸ˆå¤§ç‰ˆæ•°å­¦')"><div class="popular-icon">ğŸ”¢</div><div class="popular-title">åŒ—å¸ˆå¤§ç‰ˆæ•°å­¦</div><div class="popular-count" id="pop-bsd-math">22æœ¬</div></button>
                <button class="popular-btn" onclick="quickTextbookFilter('è‹æ•™ç‰ˆæ•°å­¦')"><div class="popular-icon">ğŸ“</div><div class="popular-title">è‹æ•™ç‰ˆæ•°å­¦</div><div class="popular-count" id="pop-sj-math">16æœ¬</div></button>
                <button class="popular-btn" onclick="quickTextbookFilter('å¤–ç ”ç‰ˆè‹±è¯­')"><div class="popular-icon">ğŸŒ</div><div class="popular-title">å¤–ç ”ç‰ˆè‹±è¯­</div><div class="popular-count" id="pop-wy-english">58æœ¬</div></button>
            </div>
        </div>
    </section>


    <!-- ä¸»ä½“å†…å®¹ -->
    <main class="container">
        <div class="main">
            <!-- ç­›é€‰é¢æ¿ -->
            <aside class="filters" id="filterPanel">
                <div class="filter-header">
                    <h3>ç­›é€‰æ¡ä»¶</h3>
                    <span class="filter-clear-all" onclick="clearAllFilters()">æ¸…é™¤å…¨éƒ¨</span>
                </div>
                
                <div class="filter-group">
                    <div class="filter-title">
                        å­¦æ®µ
                        <span class="filter-clear" onclick="clearFilter('stage')">æ¸…é™¤</span>
                    </div>
                    <div class="filter-items" id="stageFilters">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-title">
                        å­¦ç§‘
                        <span class="filter-clear" onclick="clearFilter('subject')">æ¸…é™¤</span>
                    </div>
                    <div class="filter-items" id="subjectFilters">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-title">
                        ç‰ˆæœ¬
                        <span class="filter-clear" onclick="clearFilter('publisher')">æ¸…é™¤</span>
                    </div>
                    <div class="filter-items" id="publisherFilters">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-title">
                        å¹´çº§
                        <span class="filter-clear" onclick="clearFilter('grade')">æ¸…é™¤</span>
                    </div>
                    <div class="filter-items" id="gradeFilters">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </aside>

            <!-- å†…å®¹åŒºåŸŸ -->
            <section class="content">
                <!-- å·¥å…·æ  -->
                <div class="toolbar">
                    <div class="result-info">
                        æ‰¾åˆ° <strong id="resultCount">0</strong> æœ¬æ•™æ
                    </div>
                    <div class="toolbar-actions">
                        <select class="sort-select" id="sortSelect" onchange="sortTextbooks()">
                            <option value="">é»˜è®¤æ’åº</option>
                            <option value="name">æŒ‰åç§°æ’åº</option>
                            <option value="grade">æŒ‰å¹´çº§æ’åº</option>
                            <option value="subject">æŒ‰å­¦ç§‘æ’åº</option>
                            <option value="stage">æŒ‰å­¦æ®µæ’åº</option>
                        </select>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="table" onclick="switchView('table')">
                                ğŸ“‹
                            </button>
                            <button class="view-btn" data-view="grid" onclick="switchView('grid')">
                                ğŸ“¦
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æ•™æåˆ—è¡¨ -->
                <div id="textbookList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½æ•™ææ•°æ®...</p>
                    </div>
                </div>

                <!-- åˆ†é¡µ -->
                <div class="pagination" id="pagination"></div>
            </section>
        </div>
    </main>

    <!-- ç§»åŠ¨ç«¯ç­›é€‰æŒ‰é’® -->
    <button class="mobile-filter-btn" onclick="toggleFilters()">
        ğŸ”
    </button>

    <!-- ç§»åŠ¨ç«¯é®ç½© -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="toggleFilters()"></div>

    <!-- ä¸‹è½½å¼¹çª— -->
    <div class="modal" id="downloadModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">ä¸‹è½½æ•™æ</h3>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalBody">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
        </div>
    </div>

    <!-- æ•™ææ•°æ® -->
    <script src="textbooks.js"></script>
    
    <!-- åº”ç”¨é€»è¾‘ -->
    <script>
        // åº”ç”¨çŠ¶æ€
        const app = {
            textbooks: [],
            filteredTextbooks: [],
            currentPage: 1,
            pageSize: 20,
            viewMode: 'table',
            filters: {
                stage: [],
                subject: [],
                publisher: [],
                grade: [],
                search: ''
            }
        };

        // åˆå§‹åŒ–
        function init() {
            // åŠ è½½æ•°æ®
            app.textbooks = TEXTBOOKS || [];
            app.filteredTextbooks = [...app.textbooks];
            
            // æ›´æ–°æ€»æ•°
            document.getElementById('totalCount').textContent = app.textbooks.length;
            
            // ç”Ÿæˆç­›é€‰å™¨
            generateFilters();
            
            // æ¸²æŸ“åˆ—è¡¨
            renderTextbooks();
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // æ¢å¤ä¸»é¢˜
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
        }

        // ç”Ÿæˆç­›é€‰å™¨
        function generateFilters() {
            // ç»Ÿè®¡å„ç»´åº¦æ•°æ®
            const stats = {
                stage: {},
                subject: {},
                publisher: {},
                grade: {}
            };
            
            app.textbooks.forEach(textbook => {
                // å­¦æ®µ
                if (textbook.stage) {
                    stats.stage[textbook.stage] = (stats.stage[textbook.stage] || 0) + 1;
                }
                
                // å­¦ç§‘
                if (textbook.subject) {
                    stats.subject[textbook.subject] = (stats.subject[textbook.subject] || 0) + 1;
                }
                
                // ç‰ˆæœ¬
                if (textbook.publisher) {
                    stats.publisher[textbook.publisher] = (stats.publisher[textbook.publisher] || 0) + 1;
                }
                
                // å¹´çº§ - æå–ä¸»è¦å¹´çº§ä¿¡æ¯ï¼ˆå»é™¤å†Œåˆ«ï¼‰
                if (textbook.gradeStr) {
                    // æå–å¹´çº§éƒ¨åˆ†ï¼Œå»é™¤"ä¸Šå†Œ"ã€"ä¸‹å†Œ"ç­‰
                    let gradeKey = textbook.gradeStr;
                    if (gradeKey.includes('ä¸Šå†Œ') || gradeKey.includes('ä¸‹å†Œ')) {
                        gradeKey = gradeKey.replace(/ä¸Šå†Œ|ä¸‹å†Œ/g, '').trim();
                    }
                    if (gradeKey && gradeKey !== '') {
                        stats.grade[gradeKey] = (stats.grade[gradeKey] || 0) + 1;
                    }
                }
            });
            
            // æ¸²æŸ“ç­›é€‰ç»„
            renderFilterGroup('stageFilters', stats.stage, 'stage');
            renderFilterGroup('subjectFilters', stats.subject, 'subject');
            renderFilterGroup('publisherFilters', stats.publisher, 'publisher');
            renderFilterGroup('gradeFilters', stats.grade, 'grade');
        }

        // æ¸²æŸ“ç­›é€‰ç»„
        function renderFilterGroup(containerId, stats, filterType) {
            const container = document.getElementById(containerId);
            const items = Object.entries(stats)
                .filter(([key]) => key && key !== '0')
                .sort((a, b) => {
                    // æŒ‰æ•°é‡é™åºæ’åº
                    return b[1] - a[1];
                });
            
            container.innerHTML = items.map(([item, count], index) => {
                const value = item;
                const displayText = item;
                
                return `
                    <div class="filter-item">
                        <input type="checkbox" 
                               id="${filterType}-${index}" 
                               value="${value}" 
                               onchange="filterChange('${filterType}', this)">
                        <label for="${filterType}-${index}">${displayText}</label>
                        <span class="filter-count">${count}</span>
                    </div>
                `;
            }).join('');
        }

        // ç­›é€‰å˜åŒ–
        function filterChange(type, checkbox) {
            const value = checkbox.value;
            if (checkbox.checked) {
                app.filters[type].push(value);
            } else {
                const index = app.filters[type].indexOf(value);
                if (index > -1) {
                    app.filters[type].splice(index, 1);
                }
            }
            applyFilters();
        }

        // å¹´çº§ä¸­æ–‡æ•°å­—æ˜ å°„
        const gradeMap = {
            'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5, 
            'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9,
            '1': 1, '2': 2, '3': 3, '4': 4, '5': 5,
            '6': 6, '7': 7, '8': 8, '9': 9
        };

        // å°†æœç´¢è¯è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
        function normalizeSearchTerm(term) {
            // ä¸å†è¿›è¡Œå¹´çº§çš„æ•°å­—è½¬æ¢ï¼Œä¿æŒåŸæ ·
            // è¿™æ ·"ä¸‰å¹´çº§"å°±èƒ½åŒ¹é…æ•°æ®ä¸­çš„"ä¸‰å¹´çº§"
            return term;
        }

        // æ£€æŸ¥æ˜¯å¦åŒ¹é…æœç´¢
        function matchesSearch(textbook, searchTerms) {
            // æ„å»ºæœç´¢æ–‡æœ¬ï¼ŒåŒ…å«æ‰€æœ‰ç›¸å…³å­—æ®µ
            const searchableFields = [
                textbook.name,
                textbook.subject,
                textbook.stage,
                textbook.publisher,
                textbook.gradeStr,
                textbook.term,
                textbook.originalTitle
            ].filter(Boolean);
            
            const searchableText = searchableFields.join(' ').toLowerCase();
            
            // æ£€æŸ¥æ¯ä¸ªæœç´¢è¯æ˜¯å¦éƒ½èƒ½åŒ¹é…
            return searchTerms.every(term => {
                // å…ˆå°è¯•ç›´æ¥åŒ¹é…
                if (searchableText.includes(term)) {
                    return true;
                }
                
                // å¯¹å¹´çº§è¿›è¡Œç‰¹æ®Šå¤„ç†
                // æ”¯æŒ"ä¸€å¹´çº§"ã€"1å¹´çº§"ã€"ä¸€"ã€"1"ç­‰å¤šç§è¾“å…¥æ–¹å¼
                const gradeMatch = term.match(/([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹123456789])å¹´çº§?/);
                if (gradeMatch && textbook.gradeStr) {
                    const inputGrade = gradeMatch[1];
                    const gradeNum = gradeMap[inputGrade];
                    
                    if (gradeNum) {
                        // è·å–å¯¹åº”çš„ä¸­æ–‡æ•°å­—
                        const chineseNum = Object.keys(gradeMap).find(key => 
                            gradeMap[key] === gradeNum && ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'].includes(key)
                        );
                        
                        // æ£€æŸ¥å¤šç§å¯èƒ½çš„åŒ¹é…
                        if (textbook.gradeStr.includes(inputGrade + 'å¹´çº§') || // ç›´æ¥åŒ¹é…ï¼ˆå¦‚"ä¸‰å¹´çº§"ï¼‰
                            textbook.gradeStr.includes(gradeNum + 'å¹´çº§') || // æ•°å­—åŒ¹é…ï¼ˆå¦‚"3å¹´çº§"ï¼‰
                            (chineseNum && textbook.gradeStr.includes(chineseNum + 'å¹´çº§'))) { // ä¸­æ–‡åŒ¹é…
                            return true;
                        }
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦åªè¾“å…¥äº†å¹´çº§æ•°å­—æˆ–ä¸­æ–‡
                if (gradeMap[term] && textbook.gradeStr) {
                    const gradeNum = gradeMap[term];
                    const chineseNum = Object.keys(gradeMap).find(key => 
                        gradeMap[key] === gradeNum && ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'].includes(key)
                    );
                    
                    if (textbook.gradeStr.includes(term + 'å¹´çº§') || 
                        textbook.gradeStr.includes(gradeNum + 'å¹´çº§') ||
                        (chineseNum && textbook.gradeStr.includes(chineseNum + 'å¹´çº§'))) {
                        return true;
                    }
                }
                
                return false;
            });
        }

        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            app.filteredTextbooks = app.textbooks.filter(textbook => {
                // æœç´¢ç­›é€‰
                if (app.filters.search) {
                    const searchLower = app.filters.search.toLowerCase().trim();
                    
                    // åˆ†è¯å¤„ç†ï¼šæŒ‰ç©ºæ ¼ã€é€—å·ç­‰åˆ†å‰²
                    const searchTerms = searchLower
                        .split(/[\s,ï¼Œã€]+/)
                        .filter(term => term.length > 0)
                        .map(term => normalizeSearchTerm(term));
                    
                    // å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„æœç´¢è¯ï¼Œè·³è¿‡æœç´¢ç­›é€‰
                    if (searchTerms.length === 0) {
                        return true;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰æœç´¢è¯
                    if (!matchesSearch(textbook, searchTerms)) {
                        return false;
                    }
                }
                
                // åˆ†ç±»ç­›é€‰
                if (app.filters.stage.length && !app.filters.stage.includes(textbook.stage)) return false;
                if (app.filters.subject.length && !app.filters.subject.includes(textbook.subject)) return false;
                // å‡ºç‰ˆç¤¾ç­›é€‰ - æ”¯æŒéƒ¨åˆ†åŒ¹é…
                if (app.filters.publisher.length) {
                    let publisherMatched = false;
                    for (let filterPublisher of app.filters.publisher) {
                        if (textbook.publisher && textbook.publisher.includes(filterPublisher)) {
                            publisherMatched = true;
                            break;
                        }
                    }
                    if (!publisherMatched) return false;
                }
                // å¹´çº§ç­›é€‰ - æ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼ˆå¿½ç•¥å†Œåˆ«ï¼‰
                if (app.filters.grade.length) {
                    let gradeMatched = false;
                    for (let filterGrade of app.filters.grade) {
                        if (textbook.gradeStr && textbook.gradeStr.includes(filterGrade)) {
                            gradeMatched = true;
                            break;
                        }
                    }
                    if (!gradeMatched) return false;
                }
                
                return true;
            });
            
            app.currentPage = 1;
            renderTextbooks();
        }

        // æ¸²æŸ“æ•™æåˆ—è¡¨
        function renderTextbooks() {
            const start = (app.currentPage - 1) * app.pageSize;
            const end = start + app.pageSize;
            const pageData = app.filteredTextbooks.slice(start, end);
            
            // æ›´æ–°ç»“æœæ•°é‡
            document.getElementById('resultCount').textContent = app.filteredTextbooks.length;
            
            const listContainer = document.getElementById('textbookList');
            
            if (pageData.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty">
                        <div class="empty-icon">ğŸ“­</div>
                        <p class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•™æ</p>
                        <p class="empty-hint">è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯</p>
                    </div>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            if (app.viewMode === 'table') {
                renderTableView(listContainer, pageData);
            } else {
                renderGridView(listContainer, pageData);
            }
            
            // æ¸²æŸ“åˆ†é¡µ
            renderPagination();
        }

        // è¡¨æ ¼è§†å›¾
        function renderTableView(container, data) {
            container.innerHTML = `
                <table class="textbook-table">
                    <thead>
                        <tr>
                            <th>æ•™æåç§°</th>
                            <th class="hide-mobile">å­¦æ®µ</th>
                            <th>å­¦ç§‘</th>
                            <th class="hide-mobile">å¹´çº§</th>
                            <th class="hide-mobile">ç‰ˆæœ¬</th>
                            <th>å¤§å°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(textbook => `
                            <tr>
                                <td>
                                    <div class="textbook-name">${textbook.name}</div>
                                    <div class="textbook-meta hide-mobile">
                                        <span class="meta-tag">ğŸ“– ${textbook.originalTitle || textbook.name}</span>
                                    </div>
                                </td>
                                <td class="hide-mobile">${textbook.stage || '-'}</td>
                                <td>${textbook.subject || '-'}</td>
                                <td class="hide-mobile">${textbook.gradeStr || '-'} ${textbook.term || ''}</td>
                                <td class="hide-mobile">${textbook.publisher || '-'}</td>
                                <td>${textbook.size}</td>
                                <td>
                                    <button class="btn-download" onclick="showDownload(${textbook.id})">
                                        <span>ä¸‹è½½</span>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ç½‘æ ¼è§†å›¾
        function renderGridView(container, data) {
            container.innerHTML = `
                <div class="textbook-grid">
                    ${data.map(textbook => `
                        <div class="textbook-card" onclick="showDownload(${textbook.id})">
                            <div class="card-header">
                                <h3 class="card-title">${textbook.name}</h3>
                            </div>
                            <div class="card-meta">
                                ${textbook.stage ? `<span class="card-tag primary">${textbook.stage}</span>` : ''}
                                ${textbook.subject ? `<span class="card-tag">${textbook.subject}</span>` : ''}
                                ${textbook.gradeStr ? `<span class="card-tag">${textbook.gradeStr}${textbook.term ? ' ' + textbook.term : ''}</span>` : ''}
                                ${textbook.publisher ? `<span class="card-tag">${textbook.publisher}</span>` : ''}
                            </div>
                            <div class="card-footer">
                                <span class="card-size">ğŸ“„ ${textbook.size}</span>
                                <button class="btn-download" onclick="event.stopPropagation(); showDownload(${textbook.id})">
                                    ä¸‹è½½
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // æ¸²æŸ“åˆ†é¡µ
        function renderPagination() {
            const totalPages = Math.ceil(app.filteredTextbooks.length / app.pageSize);
            const container = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // ä¸Šä¸€é¡µ
            html += `<button class="page-btn" onclick="goToPage(${app.currentPage - 1})" 
                     ${app.currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
            
            // é¡µç é€»è¾‘
            const maxButtons = 7;
            let startPage = 1;
            let endPage = totalPages;
            
            if (totalPages > maxButtons) {
                const half = Math.floor(maxButtons / 2);
                if (app.currentPage <= half) {
                    endPage = maxButtons - 1;
                } else if (app.currentPage >= totalPages - half) {
                    startPage = totalPages - maxButtons + 2;
                } else {
                    startPage = app.currentPage - half + 1;
                    endPage = app.currentPage + half - 1;
                }
            }
            
            // ç¬¬ä¸€é¡µ
            if (startPage > 1) {
                html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span class="page-ellipsis">...</span>`;
                }
            }
            
            // ä¸­é—´é¡µç 
            for (let i = startPage; i <= endPage; i++) {
                if (i > 0 && i <= totalPages) {
                    html += `<button class="page-btn ${i === app.currentPage ? 'active' : ''}" 
                             onclick="goToPage(${i})">${i}</button>`;
                }
            }
            
            // æœ€åä¸€é¡µ
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span class="page-ellipsis">...</span>`;
                }
                html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            // ä¸‹ä¸€é¡µ
            html += `<button class="page-btn" onclick="goToPage(${app.currentPage + 1})" 
                     ${app.currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
            
            container.innerHTML = html;
        }

        // è·³è½¬é¡µé¢
        function goToPage(page) {
            const totalPages = Math.ceil(app.filteredTextbooks.length / app.pageSize);
            if (page < 1 || page > totalPages) return;
            
            app.currentPage = page;
            renderTextbooks();
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            const content = document.querySelector('.content');
            content.scrollTop = 0;
        }

        // æœç´¢
        function search() {
            app.filters.search = document.getElementById('searchInput').value.trim();
            applyFilters();
        }

        // å¿«é€Ÿç­›é€‰
        function quickFilter(type, value) {
            // åˆ‡æ¢å¿«æ·æŒ‰é’®çŠ¶æ€
            const btn = event.target;
            btn.classList.toggle('active');
            
            if (btn.classList.contains('active')) {
                // æ·»åŠ ç­›é€‰
                if (type === 'grade') {
                    app.filters[type].push(parseInt(value));
                } else {
                    app.filters[type].push(value);
                }
            } else {
                // ç§»é™¤ç­›é€‰
                const index = app.filters[type].indexOf(type === 'grade' ? parseInt(value) : value);
                if (index > -1) {
                    app.filters[type].splice(index, 1);
                }
            }
            
            // æ›´æ–°å¯¹åº”çš„å¤é€‰æ¡†
            updateFilterCheckboxes();
            applyFilters();
        }

        // æ›´æ–°ç­›é€‰å¤é€‰æ¡†çŠ¶æ€
        function updateFilterCheckboxes() {
            // æ›´æ–°æ‰€æœ‰å¤é€‰æ¡†
            ['stage', 'subject', 'publisher', 'grade'].forEach(type => {
                document.querySelectorAll(`#${type}Filters input`).forEach(input => {
                    const value = type === 'grade' ? parseInt(input.value) : input.value;
                    input.checked = app.filters[type].includes(value);
                });
            });
        }

        // æ¸…é™¤ç­›é€‰
        function clearFilter(type) {
            app.filters[type] = [];
            updateFilterCheckboxes();
            
            // æ¸…é™¤å¯¹åº”çš„å¿«æ·æŒ‰é’®
            document.querySelectorAll('.quick-btn').forEach(btn => {
                const [filterType, filterValue] = getQuickFilterInfo(btn);
                if (filterType === type) {
                    btn.classList.remove('active');
                }
            });
            
            applyFilters();
        }

        // æ¸…é™¤æ‰€æœ‰ç­›é€‰
        function clearAllFilters() {
            app.filters = {
                stage: [],
                subject: [],
                publisher: [],
                grade: [],
                search: app.filters.search
            };
            
            updateFilterCheckboxes();
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            applyFilters();
        }

        // è·å–å¿«æ·ç­›é€‰ä¿¡æ¯
        function getQuickFilterInfo(btn) {
            const onclick = btn.getAttribute('onclick');
            const match = onclick.match(/quickFilter\('(\w+)',\s*'([^']+)'\)/);
            return match ? [match[1], match[2]] : [null, null];
        }

        // æ’åº
        function sortTextbooks() {
            const sortBy = document.getElementById('sortSelect').value;
            if (!sortBy) {
                app.filteredTextbooks = [...app.filteredTextbooks];
            } else {
                app.filteredTextbooks.sort((a, b) => {
                    switch(sortBy) {
                        case 'name':
                            return (a.name || '').localeCompare(b.name || '', 'zh-CN');
                        case 'grade':
                            // ä½¿ç”¨ gradeStr è¿›è¡Œæ’åº
                            const aGrade = a.gradeStr || '';
                            const bGrade = b.gradeStr || '';
                            return aGrade.localeCompare(bGrade, 'zh-CN');
                        case 'subject':
                            return (a.subject || '').localeCompare(b.subject || '', 'zh-CN');
                        case 'stage':
                            const stageOrder = ['å°å­¦', 'åˆä¸­', 'é«˜ä¸­', 'ç‰¹æ®Šæ•™è‚²', 'æ•™å­¦æŒ‡å—'];
                            return stageOrder.indexOf(a.stage) - stageOrder.indexOf(b.stage);
                        default:
                            return 0;
                    }
                });
            }
            
            app.currentPage = 1;
            renderTextbooks();
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            app.viewMode = view;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            renderTextbooks();
        }

        // è·å–æ•™æçš„ç™¾åº¦ç½‘ç›˜ä¿¡æ¯
        function getBaiduInfo(textbook) {
            const stage = textbook.stage;
            
            // å¤„ç†ç‰¹æ®Šæƒ…å†µ
            if (stage.includes('äº”â€¢å››å­¦åˆ¶')) {
                if (stage.includes('å°å­¦')) return BAIDU_DISK_SHARES['å°å­¦54'];
                if (stage.includes('åˆä¸­')) return BAIDU_DISK_SHARES['åˆä¸­54'];
            }
            
            // æ˜ å°„ç‰¹æ®Šåç§°
            const stageMap = {
                'ç‰¹æ®Šæ•™è‚²': 'ç‰¹æ•™',
                'æ•™å¸ˆç”¨ä¹¦': 'æ•™å¸ˆç”¨ä¹¦'
            };
            
            const mappedStage = stageMap[stage] || stage;
            return BAIDU_DISK_SHARES[mappedStage] || BAIDU_DISK_SHARES['å°å­¦']; // é»˜è®¤è¿”å›å°å­¦
        }

        // æ˜¾ç¤ºä¸‹è½½å¼¹çª—
        function showDownload(id) {
            const textbook = app.textbooks.find(t => t.id === id);
            if (!textbook) return;
            
            // ä»BAIDU_DISK_SHARESè·å–ç™¾åº¦ç½‘ç›˜ä¿¡æ¯
            const baiduInfo = getBaiduInfo(textbook);
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="download-info">
                    <h4>${textbook.name}</h4>
                    <p>ğŸ“š ${textbook.stage} - ${textbook.subject} - ${textbook.gradeStr || ''} ${textbook.term}</p>
                    <p>ğŸ“– å‡ºç‰ˆç¤¾ï¼š${textbook.publisher || 'æœªçŸ¥'}</p>
                    <p>ğŸ“Š æ–‡ä»¶å¤§å°ï¼š${textbook.size}</p>
                </div>
                
                <div class="download-field">
                    <label>ğŸ“ ç™¾åº¦ç½‘ç›˜é“¾æ¥ï¼ˆ${textbook.stage}ï¼‰ï¼š</label>
                    <div class="download-link">
                        <input type="text" value="${baiduInfo.link}" id="link-${id}" readonly>
                        <span class="copy-icon" onclick="copyTextIcon('link-${id}', this)" title="å¤åˆ¶é“¾æ¥">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </span>
                    </div>
                </div>
                
                <div class="download-field">
                    <label>ğŸ”‘ æå–ç ï¼š</label>
                    <div class="download-link">
                        <input type="text" value="${baiduInfo.pwd}" id="pwd-${id}" readonly>
                        <span class="copy-icon" onclick="copyTextIcon('pwd-${id}', this)" title="å¤åˆ¶æå–ç ">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </span>
                    </div>
                </div>
                
                <div class="download-field download-field-path">
                    <label>ğŸ“ æ–‡ä»¶è·¯å¾„ï¼ˆåœ¨ç™¾åº¦ç½‘ç›˜ä¸­çš„ä½ç½®ï¼‰ï¼š</label>
                    <div class="download-link">
                        <input type="text" value="${textbook.pathInDisk}" id="path-${id}" readonly>
                        <span class="copy-icon" onclick="copyTextIcon('path-${id}', this)" title="å¤åˆ¶è·¯å¾„">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </span>
                    </div>
                </div>
                
                <button class="btn-open" onclick="window.open('${baiduInfo.link}', '_blank')">
                    ğŸš€ æ‰“å¼€ç™¾åº¦ç½‘ç›˜
                </button>
                
                <div class="download-tips">
                    <h5>ä¸‹è½½æ­¥éª¤ï¼š</h5>
                    <ul>
                        <li>1. ç‚¹å‡»"æ‰“å¼€ç™¾åº¦ç½‘ç›˜"æˆ–å¤åˆ¶é“¾æ¥åˆ°æµè§ˆå™¨</li>
                        <li>2. è¾“å…¥æå–ç ï¼š<strong>${baiduInfo.pwd}</strong></li>
                        <li>3. è¿›å…¥ç™¾åº¦ç½‘ç›˜åï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–‡ä»¶è·¯å¾„æ‰¾åˆ°æ•™æ</li>
                        <li>4. æ–‡ä»¶åï¼š<strong>${textbook.fileName}</strong></li>
                    </ul>
                </div>
            `;
            
            document.getElementById('downloadModal').classList.add('show');
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('downloadModal').classList.remove('show');
        }

        // ç‚¹å‡»é®ç½©å…³é—­å¼¹çª—
        function closeModalOnOverlay(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        // å¤åˆ¶æ–‡æœ¬ï¼ˆæ–°ç‰ˆï¼Œä½¿ç”¨å›¾æ ‡ï¼‰
        function copyTextIcon(inputId, iconElement) {
            const input = document.getElementById(inputId);
            
            // é€‰æ‹©æ–‡æœ¬
            input.select();
            input.setSelectionRange(0, 99999);
            
            // å¤åˆ¶
            try {
                document.execCommand('copy');
                
                // æˆåŠŸæç¤º
                iconElement.classList.add('copied');
                const originalTitle = iconElement.title;
                iconElement.title = 'å·²å¤åˆ¶';
                
                // æ›´æ”¹å›¾æ ‡ä¸ºå‹¾é€‰
                iconElement.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                `;
                
                setTimeout(() => {
                    iconElement.classList.remove('copied');
                    iconElement.title = originalTitle;
                    // æ¢å¤åŸå§‹å›¾æ ‡
                    iconElement.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    `;
                }, 2000);
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
            }
        }

        // åˆ‡æ¢ç­›é€‰é¢æ¿ï¼ˆç§»åŠ¨ç«¯ï¼‰
        function toggleFilters() {
            const filterPanel = document.getElementById('filterPanel');
            const overlay = document.getElementById('mobileOverlay');
            
            filterPanel.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeToggle(newTheme);
        }

        // æ›´æ–°ä¸»é¢˜æŒ‰é’®
        function updateThemeToggle(theme) {
            const btn = document.getElementById('themeToggle');
            btn.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            btn.title = theme === 'light' ? 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼' : 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼';
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æœç´¢æ¡†äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(() => {
                app.filters.search = searchInput.value.trim();
                applyFilters();
            }, 300));
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    search();
                }
            });
            
            // ä¸»é¢˜åˆ‡æ¢
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // ESCé”®å…³é—­
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    if (window.innerWidth <= 1024) {
                        const filterPanel = document.getElementById('filterPanel');
                        const overlay = document.getElementById('mobileOverlay');
                        filterPanel.classList.remove('show');
                        overlay.classList.remove('show');
                    }
                }
            });
            
            // çª—å£å¤§å°æ”¹å˜
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    if (window.innerWidth > 1024) {
                        const filterPanel = document.getElementById('filterPanel');
                        const overlay = document.getElementById('mobileOverlay');
                        filterPanel.classList.remove('show');
                        overlay.classList.remove('show');
                    }
                }, 150);
            });
        }


        // å¿«é€Ÿæ•™æç­›é€‰åŠŸèƒ½
        function quickTextbookFilter(filterName) {
            // æ¸…é™¤ç°æœ‰ç­›é€‰
            clearAllFilters();
            
            // æ ¹æ®ä¸åŒçš„ç­›é€‰åç§°è®¾ç½®è¿‡æ»¤æ¡ä»¶
            switch(filterName) {
                case 'ç»Ÿç¼–ç‰ˆå°å­¦è¯­æ–‡':
                    app.filters.publisher.push('ç»Ÿç¼–ç‰ˆ');
                    app.filters.stage.push('å°å­¦');
                    app.filters.subject.push('è¯­æ–‡');
                    break;
                case 'äººæ•™ç‰ˆå°å­¦æ•°å­¦':
                    app.filters.publisher.push('äººæ•™');
                    app.filters.stage.push('å°å­¦');
                    app.filters.subject.push('æ•°å­¦');
                    break;
                case 'äººæ•™ç‰ˆåˆä¸­å…¨å¥—':
                    app.filters.publisher.push('äººæ•™');
                    app.filters.stage.push('åˆä¸­');
                    break;
                case 'åŒ—å¸ˆå¤§ç‰ˆæ•°å­¦':
                    app.filters.publisher.push('åŒ—å¸ˆå¤§ç‰ˆ');
                    app.filters.subject.push('æ•°å­¦');
                    break;
                case 'è‹æ•™ç‰ˆæ•°å­¦':
                    app.filters.publisher.push('è‹æ•™ç‰ˆ');
                    app.filters.subject.push('æ•°å­¦');
                    break;
                case 'å¤–ç ”ç‰ˆè‹±è¯­':
                    app.filters.publisher.push('å¤–ç ”ç¤¾');
                    app.filters.subject.push('è‹±è¯­');
                    break;
            }
            
            // æ›´æ–°ç­›é€‰å™¨å¤é€‰æ¡†çŠ¶æ€
            updateFilterCheckboxes();
            
            // åº”ç”¨ç­›é€‰
            applyFilters();
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.querySelector('.content').scrollIntoView({ behavior: 'smooth' });
        }
        
        // åˆå§‹åŒ–çƒ­é—¨æ•™ææ•°é‡ç»Ÿè®¡
        function initPopularCounts() {
            // ç»Ÿè®¡å„ä¸ªçƒ­é—¨æ•™æç»„åˆçš„æ•°é‡
            const counts = {
                'pop-tb-primary-chinese': app.textbooks.filter(t => 
                    t.publisher === 'ç»Ÿç¼–ç‰ˆ' && 
                    t.stage === 'å°å­¦' && 
                    t.subject === 'è¯­æ–‡').length,
                'pop-rj-primary-math': app.textbooks.filter(t => 
                    t.publisher && t.publisher.includes('äººæ•™') && 
                    t.stage === 'å°å­¦' && 
                    t.subject === 'æ•°å­¦').length,
                'pop-rj-middle-all': app.textbooks.filter(t => 
                    t.publisher && t.publisher.includes('äººæ•™') && 
                    t.stage === 'åˆä¸­').length,
                'pop-bsd-math': app.textbooks.filter(t => 
                    t.publisher === 'åŒ—å¸ˆå¤§ç‰ˆ' && 
                    t.subject === 'æ•°å­¦').length,
                'pop-sj-math': app.textbooks.filter(t => 
                    t.publisher === 'è‹æ•™ç‰ˆ' && 
                    t.subject === 'æ•°å­¦').length,
                'pop-wy-english': app.textbooks.filter(t => 
                    t.publisher === 'å¤–ç ”ç¤¾ç‰ˆ' && 
                    t.subject === 'è‹±è¯­').length
            };
            
            // æ›´æ–°æ˜¾ç¤º
            Object.keys(counts).forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.textContent = `${counts[id]}æœ¬`;
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            init();
            initPopularCounts();
        });
    </script>
</body>
</html>